<!DOCTYPE html>
<html lang="zh-cn">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>R bookdown 的小技巧</title>
  <meta name="author" content="" />

  

  

  <meta name="generator" content="Hugo 0.53" />

  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="/css/animate.css" rel="stylesheet">

  
  
    <link href="/css/style.blue.css" rel="stylesheet" id="theme-stylesheet">
  


  
  <link href="/css/custom.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />
  

  <link href="/css/owl.carousel.css" rel="stylesheet">
  <link href="/css/owl.theme.css" rel="stylesheet">

  <link rel="alternate" href="https://openr.netlify.com/index.xml" type="application/rss+xml" title="Open R">

  
  <meta property="og:title" content="R bookdown 的小技巧" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/zh/blog/bookdown-tips//" />
  <meta property="og:image" content="img/logo.png" />

  <script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>

</head>


  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="https://openr.netlify.com/">
                    <img src="https://openr.netlify.com/img/logo.png" alt="R bookdown 的小技巧 logo" class="hidden-xs hidden-sm">
                    <img src="https://openr.netlify.com/img/logo-small.png" alt="R bookdown 的小技巧 logo" class="visible-xs visible-sm">
                    <span class="sr-only">R bookdown 的小技巧 - 跳到主页</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">切换导航</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  <li class="dropdown">
                    
                    <a href="/zh/">主页</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/zh/blog/">博客</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/zh/faq/">常见问题</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/zh/contact/">联系我们</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/">EN</a>
                    
                  </li>
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>R bookdown 的小技巧</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        <p class="text-muted text-uppercase mb-small text-right">由 <a href="#">赵鹏</a> | September 22, 2017</p>

                        <div id="post-content">
                          


<p>本帖用来收集整理 R 语言 bookdown 扩展包的一些使用技巧。有些是在网上搜来的，有些是我在别处讨论得来的，有些是我尚未发布的，都写在这里备用。</p>
<div id="markdown-" class="section level2">
<h2>输出 Markdown 文件</h2>
<p>使用 bookdown 编译 Rmd 文件，可以得到的输出格式五花八门。对此，<a href="https://bookdown.org/yihui/bookdown/output-formats.html">bookdown 的官方文档</a> 有详细介绍，包括 github， pdf，epub，word，html 单个文档等，偏偏没有提 markdown 格式。</p>
<p>其实，markdown 文件是有的，在编译过程里作为过渡文档存在，编译结束后自动删除。编译顺利的时候，在文件夹里“刷”地闪一下就消失了。我以前的做法是“快手”，在它消失之前迅速用 notepad++ 打开，就存下来了。这显然不是办法，凑合着过日子而已。</p>
<p>一般来说，如果仅仅是使用 rmarkdown，只需在 yaml 设置里声明一下：</p>
<pre><code>output:
  md_document:
    variant: markdown_github</code></pre>
<p>然后 knit 一下，就可以得到 markdown 文件了。想当然地，我把这段代码加到了 bookdown 的yaml 里，却得到警告，说 bookdown 不支持。</p>
<p>这事儿被我搁置了很久，最后我终于在 bookdown 的项目主页找到了<a href="https://github.com/rstudio/bookdown/issues/317#issuecomment-275262486">答案</a>：参数 <code>clean = FALSE</code> 。</p>
<p><code>bookdown::render_book('index.Rmd', clean = FALSE)</code></p>
<p>我很喜欢 markdown 格式。我用 bookdown 写论文，Rmd 的正文里插了不少诸如 <code>r pi</code> 这样的调用。跟合作作者讨论时，看 Rmd 文件吧不直观，看 html 吧不方便修改，md 大概是最好的格式。</p>
<p>bookdown 的编译，我习惯按快捷键 ctrl+alt+b，或者点击右上方面板的 Build 按钮编译的，输出格式取决于 yaml。这样就得不到 md 文件。要想得到 md 文件，看来以后得改成命令行编译了。</p>
<p>我的 <a href="https://github.com/pzhaonet/bookdownplus">bookdownplus 最新版本 v1.3.1</a> ，把 <code>clean</code> 参数默认设置为 FALSE，并且在编译后把用不着的 .lol 文件删除。这样，新用户第一次用bookdown 时，就又多得到一种漂亮的输出结果。</p>
</div>
<div id="pdf-" class="section level2">
<h2>pdf 的参考文献引用格式</h2>
<p>bookdown 里引用参考文献，在 bookdown 的官方文档里有说明。例如标识为’zhao2017’ 的 bib 条目，引用的方式和输出结果为：</p>
<ul>
<li><code>@zhao2017</code>，得到 <code>Zhao (2017)</code>， 相当于 LaTeX 里的 <code>\citet{zhao2017}</code>。</li>
<li><code>[@zhao2017]</code> ，得到 <code>(Zhao, 2017)</code>， 相当于 LaTeX 里的 <code>\citep{zhao2017}</code>。</li>
</ul>
<p>但是，如果有多篇参考文献连续引用（我经常需要），就出问题了。我想得到的是 <code>(Xie, 2016; Zhao, 2017)</code>，但无论输入 <code>[@zhao2017][@xie2016]</code>, 或是<code>[@zhao2017 @xie2016]</code>，或是<code>(@zhao2017; @xie2016)</code>，都不管用。</p>
<p>管用的方法是使用 LaTeX 方式：</p>
<ul>
<li><code>\citep{zhao2017,xie2016}</code>，得到<code>(Xie, 2016; Zhao, 2017)</code>。</li>
</ul>
<p>更新：经 Yihui 提示，应当用 <code>[@zhao2017; @xie2016]</code>.</p>
</div>
<div id="pdf--1" class="section level2">
<h2>往 pdf 里插入网络图片</h2>
<p>假定往文档里插入下面这张网络图片：</p>
<p><code>url &lt;- 'https://bookdown.org/yihui/bookdown/images/cover.jpg'</code></p>
<p>一般有两种方法：</p>
<ul>
<li><code>knitr::include_graphics(url)</code></li>
<li><code>![](https://bookdown.org/yihui/bookdown/images/cover.jpg)</code></li>
</ul>
<p>得到的网页输出格式里没有任何问题，但是 pdf 却不行。</p>
<p>这是因为，生成 pdf 的 LaTeX 不支持插入网络图片。LaTeX 界的解决办法是，先用 <code>wget</code> 把网络图片下载到本地，再插入到tex 文档里。那么，我在 bookdown 里也如法炮制：</p>
<pre><code>download.file(url,&#39;cover.jpg&#39;, mode = &#39;wb&#39;)
knitr::include_graphics(&#39;cover.jpg&#39;)</code></pre>
<p>这事儿其实已经解决了，但是不够完美。如果用 bookdown 同时输出网页格式和 pdf，那么网页格式的文档里插入的图片是本地图片；如果发布到 bookdown.org，那么插入的图片来自 bookdown.org。两者都不是该图片的原始地址。有点资源浪费。</p>
<p>完美的解决方式来自<a href="https://stackoverflow.com/questions/46331896/how-can-i-insert-an-image-from-internet-to-the-pdf-file-produced-by-r-bookdown-i">Yihui 的回答</a>，在 Rmd 里这么写：</p>
<pre><code>if (!file.exists(cover_file &lt;- &#39;cover.jpg&#39;))
  download.file(url, cover_file, mode = &#39;wb&#39;)
knitr::include_graphics(if (identical(knitr:::pandoc_to(), &#39;html&#39;)) url else cover_file)</code></pre>
<p>这段代码自动判断，如果输出网页文档，就插入原始图片链接，否则就下载到本地再插入。</p>
</div>
<div id="section" class="section level2">
<h2>主控文档和子文档</h2>
<p>Word 有个很好的功能，叫做“主控文档”：如果文件太大，那么各章可以分别写在一个 word 文档（子文档）里，然后插入到另一个文档里合并。LaTeX 里也有同样的功能，用 include 指令就行了。</p>
<p>bookdown 当然也可以。官方文档对此有<a href="https://bookdown.org/yihui/bookdown/usage.html">说明</a>，只需在’_bookdown.yml’里声明即可：</p>
<pre><code>rmd_files: [&quot;chapter1.Rmd&quot;, &quot;chapter2.Rmd&quot;, &quot;chapter3.Rmd&quot;]
</code></pre>
<p>如果希望在不同格式的输出文件里包含不同的章节，比如网页格式的书里包含 1 到 3 章，而 pdf 的只包含第 1 和第 3 章，那么：</p>
<pre><code>rmd_files:
  html: [&quot;chapter1.Rmd&quot;, &quot;chapter2.Rmd&quot;, &quot;chapter3.Rmd&quot;]
  latex: [&quot;chapter1.Rmd&quot;, &quot;chapter3.Rmd&quot;]</code></pre>
<p>但是，这种方法只适合并列关系的章节，如果是总分关系的呢？比如，我想在 chapter1 里某段插入 ‘mytext.md’ 这个文本，在 chapter2 里再插入一次，该怎么办？</p>
<p><a href="https://disqus.com/home/discussion/yihui/r_markdown_notebook_jupyter_ipython_notebook/#comment-3426121547">这样办</a>：</p>
<pre class="r"><code>cat(readLines(&quot;mytext.md&quot;), sep = &quot;\n&quot;) # 结合代码段选项 results=&quot;asis&quot;, echo=FALSE</code></pre>
<p>如果深入一步，考虑上一节“往 pdf 里插入网络图片”的方法，就可以玩出更多花样，例如书的网页格式里插入 mytext.md，而 pdf 里不插。</p>
<p>如果再跟上面的 yaml 声明相结合，各个文本文件就成了乐高积木块，随心所欲组合了。</p>
</div>
<div id="bookdown.org-" class="section level2">
<h2>bookdown.org 的多账号管理</h2>
<p>在 bookdown.org 发布书稿，点击RStudio 左上面板的发布符号，会引导你用 google 账号登录。第一次登录会让你设置在 bookdown.org 的用户名，这个要重视，想个你喜欢的名字，以后就没法改了。</p>
<p>用同一账号发布书稿，一点问题都没有。但是当我用多个账号发布书稿，遇见了一些小麻烦。</p>
<p>首先，我用 <code>bookdown::publish_book()</code> 的 <code>account</code> 参数指定一个新账号，得到了错误信息:</p>
<pre><code>Error: Unknown account name &#39;newaccount&#39; (you can use the setAccountInfo function to add a new account)</code></pre>
<p>一查 setAccountInfo，不是 bookdown 包的函数，而是 rsconnect 包的函数：<code>rsconnect::setAccountInfo()</code>。然后就不知道怎么办了。</p>
<p>其实，添加账号应该点击 Rstudio 左上面板的发布按钮- Manage Account - Connect - RStudio
Connect - 输入 bookdown.org，然后往下照提示走就行了。</p>
<p>添加账号后，照理说用 <code>bookdown::publish_book()</code> 的 <code>account</code>指定一下账号，就应该能发布了吧？不，还是失败了，说 <code>name</code> 参数有问题。其实没问题。</p>
<p>怎么办？我发现必须从 Mange Account 里删掉旧 bookdown 的账号，就可以用新的账号成功发布了。</p>
<p>上面说了这么多，其实就是一句话：用不同账号往 bookdown.org 发布书稿，只需在 Manage Account 里添加并保留唯一一个账号即可。</p>
</div>

                        </div>
                        
                        
                        <div id="comments">
                            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "pzhao" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                        </div>
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">搜索</h3>
    </div>

    <div class="panel-body">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" role="search">
            <div class="input-group">
                <input type="search" name="q" class="form-control" placeholder="搜索">
                <input type="hidden" name="sitesearch" value="https://openr.netlify.com/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>
                </span>
            </div>
        </form>
    </div>
</div>











<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">标签</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            <li><a href="https://openr.netlify.com/zh/tags/beginr"><i class="fa fa-tags"></i> beginr</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/blogdown"><i class="fa fa-tags"></i> blogdown</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/bookdown"><i class="fa fa-tags"></i> bookdown</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/bookdownplus"><i class="fa fa-tags"></i> bookdownplus</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/latex"><i class="fa fa-tags"></i> latex</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/markdown"><i class="fa fa-tags"></i> markdown</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/mindr"><i class="fa fa-tags"></i> mindr</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/news"><i class="fa fa-tags"></i> news</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/openr"><i class="fa fa-tags"></i> openr</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/pagedown"><i class="fa fa-tags"></i> pagedown</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/pinyin"><i class="fa fa-tags"></i> pinyin</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/r"><i class="fa fa-tags"></i> r</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/rmd"><i class="fa fa-tags"></i> rmd</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/rosr"><i class="fa fa-tags"></i> rosr</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/steemr"><i class="fa fa-tags"></i> steemr</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/tutorial"><i class="fa fa-tags"></i> tutorial</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/word"><i class="fa fa-tags"></i> word</a>
            </li>
            
            <li><a href="https://openr.netlify.com/zh/tags/xaringan"><i class="fa fa-tags"></i> xaringan</a>
            </li>
            
        </ul>
    </div>
</div>








                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        <footer id="footer">
    <div class="container">

        
        <div class="col-md-4 col-sm-6">
            <h4>关于我们</h4>

            我们就是我们。

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

        <div class="col-md-4 col-sm-6">

             
            <h4>最新博客</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://openr.netlify.com/zh/blog/openr/">
                          
                            <img src="https://openr.netlify.com/img/banners/logo-openr.png" class="img-responsive" alt="Hugo univesal 主题的个性化设置">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://openr.netlify.com/zh/blog/openr/">Hugo univesal 主题的个性化设置</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://openr.netlify.com/zh/blog/txt-review-mode/">
                          
                            <img src="https://openr.netlify.com/img/banners/logo-openr.png" class="img-responsive" alt="纯文本编辑器的审阅模式">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://openr.netlify.com/zh/blog/txt-review-mode/">纯文本编辑器的审阅模式</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://openr.netlify.com/zh/blog/literature-management/">
                          
                            <img src="https://openr.netlify.com/img/banners/logo-openr.png" class="img-responsive" alt="纯文本：文献管理的终极之道">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://openr.netlify.com/zh/blog/literature-management/">纯文本：文献管理的终极之道</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg">
             

        </div>
        

        
        <div class="col-md-4 col-sm-6">

          <h4>联系</h4>

            <strong>OpenR Team</strong>
      </p>
      


            <a href="/contact" class="btn btn-small btn-template-main">跳到联系页面</a>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright (c) 2019, OpenR Team; all rights reserved.</p>
            
            <p class="pull-right">
              模板来自 <a href="http://bootstrapious.com/free-templates">Bootstrapious</a>.
              

              移植到 Hugo 来自 <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>
            </p>
        </div>
    </div>
</div>





    </div>
    

    
<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>

<script src="//maps.googleapis.com/maps/api/js?v=3.exp"></script>

<script src="https://openr.netlify.com/js/hpneo.gmaps.js"></script>
<script src="https://openr.netlify.com/js/gmaps.init.js"></script>
<script src="https://openr.netlify.com/js/front.js"></script>


<script src="https://openr.netlify.com/js/owl.carousel.min.js"></script>


  </body>
</html>
