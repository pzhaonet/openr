<!DOCTYPE html>
<html lang="zh-cn">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>用 markdown 的逻辑写 R 脚本注释（2）</title>
  <meta name="author" content="" />

  
  <meta name="keywords" content="devows, hugo, go">	
  

  
  <meta name="description" content="Site template made by devcows using hugo">	
  

  <meta name="generator" content="Hugo 0.54.0" />

  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="/css/animate.css" rel="stylesheet">

  
  
    <link href="/css/style.blue.css" rel="stylesheet" id="theme-stylesheet">
  


  
  <link href="/css/custom.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />
  

  <link href="/css/owl.carousel.css" rel="stylesheet">
  <link href="/css/owl.theme.css" rel="stylesheet">

  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Open R">

  
  <meta property="og:title" content="用 markdown 的逻辑写 R 脚本注释（2）" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/zh/blog/2018/11/16/2018-11-16-r-with-markdown2//" />
  <meta property="og:image" content="img/banners/logo-openr.png" />

</head>


  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="/">
                    <img src="/img/banners/logo-openr.png" alt="用 markdown 的逻辑写 R 脚本注释（2） logo" class="hidden-xs hidden-sm">
                    <img src="/img/logo-small.png" alt="用 markdown 的逻辑写 R 脚本注释（2） logo" class="visible-xs visible-sm">
                    <span class="sr-only">用 markdown 的逻辑写 R 脚本注释（2） - 跳到主页</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">切换导航</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  <li class="dropdown">
                    
                    <a href="/zh/">主页</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/zh/blog/">博客</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/zh/faq/">常见问题</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/zh/contact/">联系我们</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/">EN</a>
                    
                  </li>
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>用 markdown 的逻辑写 R 脚本注释（2）</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        <p class="text-muted text-uppercase mb-small text-right">由 <a href="#">赵鹏</a> | November 16, 2018</p>

                        <div id="post-content">
                          <p><a href="http://www.pzhao.org/zh/post/r-with-markdown/">上回</a>我抱怨没有现成的函数直接把 .R 脚本转换成 .Rmd 文档，于是自作聪明写了一个，结果很快 yihui 就留言说，有啊，<code>knitr::spin()</code> 就可以。我就去研究了一下这个函数，发现比我写的那个要漂亮得多。</p>

<p>我的心情很复杂。</p>

<p>话说诗仙李白当年游山玩水，看见什么就写什么，留下的诗篇个个照耀千古。有一天，他来到了黄鹤楼，照例诗兴大发，正待提笔，突然看见了墙上有前辈崔颢题写的一首七律：</p>

<blockquote>
<p>昔人已乘黄鹤去，此地空余黄鹤楼。</p>

<p>黄鹤一去不复返，白云千载空悠悠。</p>

<p>晴川历历汉阳树，芳草萋萋鹦鹉洲。</p>

<p>日暮乡关何处是，烟波江上使人愁。</p>
</blockquote>

<p>李白又惊又喜，提笔想写，却发现根本写不出来。又好笑又好气，李白终于憋出了四句：</p>

<blockquote>
<p>一拳捶碎黄鹤楼，一脚踢翻鹦鹉洲。</p>

<p>眼前有景道不得，崔颢题诗在上头。</p>
</blockquote>

<p>莫要笑我拿李白往自己脸上贴金，嗯，内心就是那种想拳捶脚踢的冲动。</p>

<p>我常常懊恼没有时间做调研，如果事先找到巨人，再爬到他肩上会看得有多远。现在，巨人来了，我打算爬上去看一看。</p>

<h2 id="knitr-spin-的巨人之肩"><code>knitr::spin()</code>的巨人之肩</h2>

<p><code>knitr::spin()</code> 的<a href="https://yihui.name/knitr/demo/stitch/">官方文档</a> 给出了一个<a href="https://github.com/yihui/knitr/blob/master/inst/examples/knitr-spin.R">示例</a>，详细介绍了用 markdown 的逻辑来写 .R 代码的策略，而这个示例本身就是个可以转换成 .Rmd 文档的 .R 脚本。转换规则我归纳了一下，大致有六条：</p>

<table>
<thead>
<tr>
<th>.R 脚本书写规则</th>
<th><code>spin(.R脚本)</code>得到的 .Rmd 文档</th>
</tr>
</thead>

<tbody>
<tr>
<td>1. <code>#'</code>  开头的注释行</td>
<td>成为正文文字</td>
</tr>

<tr>
<td>2. <code>#+</code> 开头的注释行</td>
<td>成为代码块的选项（chunk options）</td>
</tr>

<tr>
<td>3. 双重花括号（如<code>{{mean(x)}}</code>）</td>
<td>成为行内代码（如<code>`r mean(x)`</code>）</td>
</tr>

<tr>
<td>4. 代码行</td>
<td>前后添加一对连续的三个反引号，成为代码块</td>
</tr>

<tr>
<td>5. <code>#</code>开头的普通注释行</td>
<td>保留不变，成为代码块里的注释</td>
</tr>

<tr>
<td>6. <code># /*</code> 与 <code># */</code> 之间的部分</td>
<td>跳过，不进入 .Rmd</td>
</tr>
</tbody>
</table>

<p>只要按上表的第一列规则写 .R  代码，就可以一键转换成 .Rmd 文档。这个规则高明在哪里呢？</p>

<ol>
<li>完全没有破坏 R 代码的基本规则。</li>
<li>常用的格式基本都囊括了。</li>
<li>照这个规则写的 R 代码赏心悦目。</li>
<li>够简单。前三条规则可以称为“约法三章”。照这三条来写注释就行了，第 4 第 5 条不用管，第 6 条很少用。</li>
</ol>

<p>我用这个规则写了一个脚本，成功转换，欢喜得紧。</p>

<p>然而，唯一的不完美在于：章节标题。</p>

<h2 id="mindr-r2rmd-将-r-脚本转换成-rmd-文档"><code>mindr::r2rmd()</code>：将 .R 脚本转换成 .Rmd 文档</h2>

<p>我常常用 RStudio 的快捷键 ctrl + shift + r 在 .R 脚本里生成下面这样格式的章节标签：</p>

<pre><code class="language-R"># Section label ------------
</code></pre>

<p>这样的话，在 RStudio 里会以大纲视图来显示章节标签，方便跳转。大纲视图在两处显示，即下图的右侧栏和底部按钮：</p>

<p><img src="https://cdn.steemitimages.com/DQmaUZ5poerko6956f4j6FvEAmzo2GRdb231aQ8GxmpBKUD/outline.jpg" alt="outline.jpg" /></p>

<p>很容易联想到，这个标签相当于 .Rmd 里的章节标题。如果在 .R 向 .Rmd 转换的时候，能把这个映射过去就好了。</p>

<p>这好办，在 <code>knitr::spin()</code> 的基础上，我新写了个 <code>mindr::r2rmd()</code> 函数，增补了规则 7：</p>

<table>
<thead>
<tr>
<th>.R 脚本书写规则</th>
<th>经<code>spin(.R脚本)</code>转换得到的 .Rmd 文档</th>
</tr>
</thead>

<tbody>
<tr>
<td>7. <code>#=</code>  开头的注释行</td>
<td>成为章节标题</td>
</tr>
</tbody>
</table>

<p>例如，<code>#= ## Section 1.1 ----</code> 经过 <code>mindr::r2rmd()</code>转换后，去掉了头尾，得到的是<code>## Section 1.1</code>。</p>

<p>也许有人会问：为啥不直接用约法三章的第一条，<code>#' ## Section 1.1 ----</code>来写章节标签呢？少一条规则不更好吗？</p>

<p>我原先也是这么想的，后来发现，<code>#'</code> 开头的章节标签在RStudio 是不会以大纲视图来显示的。</p>

<p>这个问题我觉得可以择吉日提交给 RStudio。目前暂时按规则 7 行事吧。</p>

<p>这里有一个<a href="https://github.com/pzhaonet/mindr/blob/master/inst/examples/r/r2rmd.R">按上述 7 条规则写的 .R 脚本示例</a>。</p>

<h2 id="mindr-rmd2r-将-rmd-文档转换成-r-脚本"><code>mindr::rmd2r()</code>: 将 .Rmd 文档转换成 .R 脚本</h2>

<p>上回说过，<code>knitr::purl()</code> 可以将 .Rmd 文档转换成 .R 脚本。乍一看以为它和 <code>knitr::spin()</code>互为反函数，但是仔细一看，并非如此，例如 chunk options 和 {{code}} 就没按原来的格式还原回去。现在，一个 .R 脚本经过上面的 <code>mindr::r2rmd()</code> 一折腾，得到的 .Rmd 更是没法原样转换回到原来的 .R 脚本了。</p>

<p>怎么办？我新写了个 <code>mindr::rmd2r()</code>函数。它跟 <code>mindr::r2rmd()</code> 互为逆操作，目前看算是比较严格的互换：</p>

<table>
<thead>
<tr>
<th>.Rmd 文档格式</th>
<th>经<code>r2rmd(.Rmd文档)</code>转换得到的 .R 脚本</th>
</tr>
</thead>

<tbody>
<tr>
<td>1. 正文文字</td>
<td>成为<code>#'</code>  开头的注释行</td>
</tr>

<tr>
<td>2. 代码块的选项（chunk options）</td>
<td>成为<code>#+</code>开头的注释行</td>
</tr>

<tr>
<td>3. 行内代码（如<code>`r mean(x)`</code>）</td>
<td>成为双重花括号（如<code>{{mean(x)}}</code>）</td>
</tr>

<tr>
<td>4. 代码块</td>
<td>成为代码行</td>
</tr>

<tr>
<td>5. 代码块里的注释</td>
<td>成为 <code>#</code> 开头的普通注释行</td>
</tr>

<tr>
<td>6. <code>&lt;!--</code> 和<code>--&gt;</code>包围的内容</td>
<td>忽略，不进入 .R 脚本</td>
</tr>

<tr>
<td>7. 章节标题</td>
<td>成为 <code>#=</code> 开头、<code>----</code>结尾的章节标签</td>
</tr>
</tbody>
</table>

<p>跟前面的表格算是一一对应。</p>

<p>这样一来，一对儿 .R 脚本和 .Rmd 文档，只需维护其中任意一个，就能直接更新到另一个里了。</p>

<h2 id="mindr-r2mm-和-mindr-mm2r-r-脚本和思维导图的相互转换"><code>mindr::r2mm()</code>和<code>mindr::mm2r()</code>：.R 脚本和思维导图的相互转换</h2>

<p>上面说的，纯属 mindr 狗拿耗子多管闲事。mindr， 本来是做思维导图的。</p>

<p>然而，这一切都是做思维导图的伏笔。</p>

<p>既然我们按上面表格约定的规则来写 .R 脚本，那么先<code>mindr::r2rmd()</code>再<code>mindr::md2mm()</code>，两步就可以把脚本里的大纲提取出来，生成思维导图了。我把这两步打了个包，新写了函数叫 <code>r2mm()</code>，直接从 .R 脚本生成思维导图。当然，反过来就是 <code>mm2r()</code>，从思维导图来创建一个 .R 脚本，以符合上面约定的规则。</p>

<p>天下终于太平了。</p>

<p><img src="https://github.com/pzhaonet/mindr/raw/master/showcase/mindr_concept_1.1.8.png" alt="" /></p>
                        </div>
                        
                        
                        <div id="comments">
                            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "pzhao" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                        </div>
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">搜索</h3>
    </div>

    <div class="panel-body">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" role="search">
            <div class="input-group">
                <input type="search" name="q" class="form-control" placeholder="搜索">
                <input type="hidden" name="sitesearch" value="/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>
                </span>
            </div>
        </form>
    </div>
</div>







<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">分类</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            <li><a href="/categories/%e6%9c%aa%e5%88%86%e7%b1%bb">未分类 (7)</a>
            </li>
            
        </ul>
    </div>
</div>








<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">标签</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            <li><a href="/tags/advr"><i class="fa fa-tags"></i> advr</a>
            </li>
            
            <li><a href="/tags/beginr"><i class="fa fa-tags"></i> beginr</a>
            </li>
            
            <li><a href="/tags/blog"><i class="fa fa-tags"></i> blog</a>
            </li>
            
            <li><a href="/tags/blogdown"><i class="fa fa-tags"></i> blogdown</a>
            </li>
            
            <li><a href="/tags/bookdown"><i class="fa fa-tags"></i> bookdown</a>
            </li>
            
            <li><a href="/tags/bookdownplus"><i class="fa fa-tags"></i> bookdownplus</a>
            </li>
            
            <li><a href="/tags/css"><i class="fa fa-tags"></i> css</a>
            </li>
            
            <li><a href="/tags/drposter"><i class="fa fa-tags"></i> drposter</a>
            </li>
            
            <li><a href="/tags/git"><i class="fa fa-tags"></i> git</a>
            </li>
            
            <li><a href="/tags/hugo"><i class="fa fa-tags"></i> hugo</a>
            </li>
            
            <li><a href="/tags/latex"><i class="fa fa-tags"></i> latex</a>
            </li>
            
            <li><a href="/tags/linux"><i class="fa fa-tags"></i> linux</a>
            </li>
            
            <li><a href="/tags/markdown"><i class="fa fa-tags"></i> markdown</a>
            </li>
            
            <li><a href="/tags/mindr"><i class="fa fa-tags"></i> mindr</a>
            </li>
            
            <li><a href="/tags/news"><i class="fa fa-tags"></i> news</a>
            </li>
            
            <li><a href="/tags/pagedown"><i class="fa fa-tags"></i> pagedown</a>
            </li>
            
            <li><a href="/tags/pinyin"><i class="fa fa-tags"></i> pinyin</a>
            </li>
            
            <li><a href="/tags/post"><i class="fa fa-tags"></i> post</a>
            </li>
            
            <li><a href="/tags/postr"><i class="fa fa-tags"></i> postr</a>
            </li>
            
            <li><a href="/tags/r"><i class="fa fa-tags"></i> r</a>
            </li>
            
            <li><a href="/tags/rmd"><i class="fa fa-tags"></i> rmd</a>
            </li>
            
            <li><a href="/tags/rosr"><i class="fa fa-tags"></i> rosr</a>
            </li>
            
            <li><a href="/tags/steemr"><i class="fa fa-tags"></i> steemr</a>
            </li>
            
            <li><a href="/tags/teaching"><i class="fa fa-tags"></i> teaching</a>
            </li>
            
            <li><a href="/tags/utopian-io"><i class="fa fa-tags"></i> utopian-io</a>
            </li>
            
            <li><a href="/tags/word"><i class="fa fa-tags"></i> word</a>
            </li>
            
            <li><a href="/tags/xaringan"><i class="fa fa-tags"></i> xaringan</a>
            </li>
            
            <li><a href="/tags/%e5%90%89%e4%bb%96"><i class="fa fa-tags"></i> 吉他</a>
            </li>
            
            <li><a href="/tags/%e5%ad%a6-r"><i class="fa fa-tags"></i> 学-r</a>
            </li>
            
        </ul>
    </div>
</div>






                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        <footer id="footer">
    <div class="container">

        
        <div class="col-md-4 col-sm-6">
            <h4>关于我们</h4>

            我们就是我们。

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

        <div class="col-md-4 col-sm-6">

             
            <h4>最新博客</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="/zh/blog/2019/02/01/2019-02-01-txt-review-mode/">
                          
                            <img src="/img/banners/logo-openr.png" class="img-responsive" alt="纯文本编辑器的审阅模式">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="/zh/blog/2019/02/01/2019-02-01-txt-review-mode/">纯文本编辑器的审阅模式</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="/zh/blog/2019/02/01/2019-02-01-literature-management/">
                          
                            <img src="/img/banners/logo-openr.png" class="img-responsive" alt="纯文本：文献管理的终极之道">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="/zh/blog/2019/02/01/2019-02-01-literature-management/">纯文本：文献管理的终极之道</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="/zh/blog/2019/01/28/2019-01-28-rstudio-ppt/">
                          
                            <img src="/img/banners/logo-openr.png" class="img-responsive" alt="往 ppt 里插入 500 张图片的小伎俩">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="/zh/blog/2019/01/28/2019-01-28-rstudio-ppt/">往 ppt 里插入 500 张图片的小伎俩</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg">
             

        </div>
        

        
        <div class="col-md-4 col-sm-6">

          <h4>联系</h4>

            <strong>OpenR Team</strong>
      </p>
      


            <a href="/contact" class="btn btn-small btn-template-main">跳到联系页面</a>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright (c) 2019, OpenR Team; all rights reserved.</p>
            
            <p class="pull-right">
              模板来自 <a href="http://bootstrapious.com/free-templates">Bootstrapious</a>.
              

              移植到 Hugo 来自 <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>
            </p>
        </div>
    </div>
</div>





    </div>
    

    
<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>

<script src="//maps.googleapis.com/maps/api/js?key=AIzaSyCFhtWLJcE30xOAjcbSFi-0fnoVmQZPb1Y&v=3.exp"></script>

<script src="/js/hpneo.gmaps.js"></script>
<script src="/js/gmaps.init.js"></script>
<script src="/js/front.js"></script>


<script src="/js/owl.carousel.min.js"></script>


  </body>
</html>
